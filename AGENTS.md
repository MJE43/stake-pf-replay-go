# Repository Guidelines

## Project Structure & Module Organization
Stake PF Replay ships as a Wails desktop app. Root `main.go` wires the desktop shell and `internal/livehttp` ingest module. The deterministic engine stays in `backend/` (`cmd/pf-service`, `internal/{api,engine,games,scan,store}`, `migrations/`). The React UI and autogenerated bindings are in `frontend/src` (components, pages, lib) with build output in `frontend/dist`. Release assets and icons live in `build/`, while longer-form docs live under `docs/`.

## Build, Test, and Development Commands
- `wails dev` / `wails build` (root): desktop live reload vs production bundle.
- `make -C backend dev`: clean → fmt → lint → test → build in one pass.
- `make -C backend run` / `run-race`: serve the API locally, optionally with the race detector.
- `make -C backend migrate`: apply SQLite migrations after schema changes.
- `npm --prefix frontend run dev|build`: iterate on the UI or emit static assets when debugging frontend-only issues.

## Coding Style & Naming Conventions
Run `make -C backend fmt lint` before opening a PR; the repo expects `gofmt` output and passes golangci-lint. Use PascalCase for exported Go symbols, `ErrThing` error sentinels, and keep game implementations table-driven. TypeScript files use 2-space indentation, PascalCase component filenames, and camelCase hooks/state. Keep imports grouped by origin (`react/...`, third-party, then local `./` blocks) and co-locate supporting types in `frontend/src/lib` or `types`.

## Testing Guidelines
Exercise Go code with `go test ./...` (via `make -C backend test`); add `test-race` when touching concurrency and `bench` for performance-sensitive scanning paths. Frontend does not ship a test runner yet—at minimum run `npm --prefix frontend run build` for type checks, and place any new Vitest/React Testing Library specs under `frontend/src/__tests__`.

## Commit & Pull Request Guidelines
Prefer Conventional Commit prefixes (`feat:`, `fix:`, `chore:`) and imperative mood lines under ~72 characters, as seen in recent history. Separate desktop shell, backend, and UI changes into focused commits. Pull requests should link issues, note the commands you ran (`wails dev`, `make test`, etc.), and attach screenshots or screencasts for UI updates. Call out new env vars, migrations, or manual steps in the description.

## Security & Configuration Tips
Desktop builds store ingest data under the OS config directory; override with `LIVE_INGEST_PORT` or `LIVE_INGEST_TOKEN` when exposing the HTTP module. Avoid committing generated `data.db*` files. After pulling migrations, rerun `make -C backend migrate` so local state matches the expected schema.
