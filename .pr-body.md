## Overview

Establishes the **canonical source of truth** for all design and implementation decisions in Stake PF Replay. This PR delivers a comprehensive backend constraint specification that prevents UI patterns incompatible with system capabilities.

## Deliverables

### 📊 Machine-Readable Inventory
**`docs/generated/backend-inventory.json`**
- Complete catalog of 30 API endpoints (Wails bindings, Live HTTP, Backend HTTP)
- Metadata: latency budgets (p50/p95), pagination rules, rate limits, consistency model
- Idempotency markers, payload size estimates, relationship mappings
- Source attribution for all performance data (benchmark tests vs estimates)

### 📖 UI Implications Guide
**`docs/generated/ui-implications.md`**
- Translates backend constraints into prescriptive UI patterns
- Resource-specific guidance (Runs, Hits, Streams, Bets)
- Loading pattern matrix (skeleton vs spinner vs progress bar by latency)
- Error taxonomy with specific copy and recovery actions
- Realtime update patterns (buffer + notification, no auto-scroll)
- **Prohibited patterns**: Infinite scroll without pagination, optimistic scan mutations, WebSocket connections

### 📜 Canonical Design Constraints
**`docs/design-constraints.md`**
- **Binding authority** for all product/design/engineering decisions
- Latency budgets by operation class (instant < 10ms → very slow > 10s)
- Pagination matrix (runs: 20/page max 100, hits: 50/page max 1000, etc.)
- Consistency model: Immediate (single-user SQLite, no distributed concerns)
- Permission model: None (local-only, no RBAC)
- Optimistic UI eligibility rules (local state only, server mutations wait for confirmation)
- Exception/waiver process with expiration tracking

### ✅ Constraint Validator
**`scripts/verify-design-constraints.mjs`**
- Automated CI validation script (fails on violations, warns on recommendations)
- 12 constraint checks including:
  - No WebSocket/SSE usage (use Wails events)
  - No optimistic mutations for scans/deletes
  - Loading states for async ops > 100ms
  - Pagination controls required (no infinite scroll)
  - Buffer pattern for realtime updates
  - Cancel buttons for long operations
  - Client-side validation of hard limits
- Waiver mechanism with approval/expiration tracking
- Exit codes: 0 (pass), 1 (violations), 2 (config error)

### 📦 Infrastructure
**`package.json`** + **`scripts/README.md`**
- Validator dependencies (glob for file scanning)
- npm scripts: `verify:constraints`, `verify:constraints:verbose`
- Updated `.gitignore` for root `node_modules`

## Key Findings

### Performance Profile
- **Instant** (< 10ms): GetGames, HashServerSeed
- **Fast** (10-100ms): List operations, single record fetches
- **Slow** (1-30s): Scans of 1K-100K nonces
- **Very Slow** (30s-5min): Large scans (100K-10M nonces, max timeout 300s)

### Critical Constraints
- Max nonce range: 10,000,000 per scan
- Max timeout: 300,000ms (5 minutes)
- Max hit limit: 100,000 results
- Pagination: Runs (20/100), Hits (50/1000), Streams (100/500), Bets (500/10000)
- No authentication/authorization (local-only desktop app)
- Consistency: Immediate (single-user SQLite)

## Validation Results

Validator scanned 59 frontend files:
- **Violations**: 0 ✅
- **Warnings**: 6 ⚠️
  - Missing nonce range validation in 4 files (types, components)
  - Suggested cancel buttons in 2 scan components

All warnings are recommendations, not blocking issues.

## How to Test Locally

```bash
# Install validator dependencies
npm install

# Run constraint validation
npm run verify:constraints

# Run with verbose output
npm run verify:constraints:verbose

# Validate manually
node scripts/verify-design-constraints.mjs --verbose
```

Expected output: "PASSED WITH WARNINGS - 0 violations, 6 warnings"

## Acceptance Criteria Checklist

- [x] `backend-inventory.json` validates as JSON with complete endpoint metadata
- [x] All endpoints documented with latency budgets (source noted)
- [x] Pagination rules specify type, defaults, and maximums for each resource
- [x] Error taxonomy maps backend errors to UI patterns with recovery actions
- [x] `ui-implications.md` provides resource-by-resource UI guidance
- [x] Optimistic UI eligibility clearly defined (local state only)
- [x] Loading patterns match latency thresholds
- [x] Realtime semantics documented (Wails events, not WebSocket)
- [x] `design-constraints.md` serves as canonical reference
- [x] Validator script implements 12+ constraint checks
- [x] Override/waiver mechanism exists with approval & expiration tracking
- [x] Validator integrated into npm scripts
- [x] Documentation for validator usage in `scripts/README.md`

## Files Changed

- `docs/design-constraints.md` (new, 800+ lines)
- `docs/generated/backend-inventory.json` (new, 1400+ lines)
- `docs/generated/ui-implications.md` (new, 900+ lines)
- `scripts/verify-design-constraints.mjs` (new, 500+ lines)
- `scripts/README.md` (new, 70+ lines)
- `package.json` (new, validator dependencies)
- `.gitignore` (updated, exclude /node_modules)

## Reviewer Quick Test

```bash
# Clone and checkout this branch
git fetch origin feat/design-constraints-ground-truth-v2
git checkout feat/design-constraints-ground-truth-v2

# Install and run validator
npm install
npm run verify:constraints
```

---

**This PR establishes enforceable design constraints validated in CI, preventing UI patterns that violate backend limitations.**
